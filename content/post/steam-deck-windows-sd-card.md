+++
slug = ""
tags = ["steamdeck"]
title = "SteamDeckでSteamOSとWindowsの両方でSDカードを使用する"
date = "2022-12-19T22:43:20+09:00"
+++

SteamDeckが届いたので原神をするために早速Windowsを入れました。
SteamOSとWindowsで内蔵ディスクを半分ずつにしたのでどちらのOSにとっても容量が微妙になってしまいました。  
（自分が買ったのは256GBモデル）

そこでSDカードを追加で買ってSteamOSとWindowsの両方の容量を拡張しました。

<!--more-->

最初に書いておきますが、これはSDカードの容量をSteamOSとWindowsの両方で**共有**する記事ではありません。
この記事ではSDカードの領域を2分割して1つをSteamOS、もう1つをWindowsで使えるようにするため、あらかじめそれぞれのOS向けに容量を決める必要があります。  
（そもそも前者の方法ができるかは不明です [^1]）

2023/8/29追記：[SSD換装のついでにbtrfs化してみました](../steamdeck-upgrade-ssd-and-install-windows/)

## 前提

* Windowsを内蔵ディスクにインストール済み  
    私は[この記事](https://yukinko.tech/howtoinstallwindowstosteamdeck/)を参考にしました
* GPartedのLive USBを作成済み  
    作り方は上の記事で説明されています

## 大まかな流れ

1. SteamOSでSDカードをフォーマット
1. GPartedでパーティションを縮小
1. 空いた領域をWindowsでフォーマット

## 手順

### SteamOSでSDカードをフォーマット

SteamOSでSDカードをフォーマットすると既存のパーティションをすべて削除してしまうようなので、
はじめにSteamOSでフォーマットしてからGPartedでパーティションを縮小することにします。

ここは特に難しくないと思います。
SDカードを挿入して、設定 > システム からフォーマットできます（スクリーンショット取れてなかった）

### GPartedでパーティションを縮小

続いてGPartedのLive USBで起動します。  
右上に表示されているディスク名が「/dev/mmcblk0」になっていることを確認します。これがSDカードのようです。  
「/dev/mmcblk0p1」を右クリック→リサイズ/移動を選択すると容量を入力します。

今回は512GBのSDカードを半分ずつにするのでサイズを256*1024で262144MiBにしました（若干誤差がありますが）  
ここで入力する容量がSteamOSで使用する容量になります。

![gparted](/steam-deck-windows-sd-card/01.jpg)

入力したら「リサイズ/縮小」を押して上の方の緑のチェックマークをクリックして変更を確定します。  
完了したらウィンドウの右上の黒いボタンをクリックして閉じ、デスクトップにあるシャットダウンのアイコンをダブルクリックしてシャットダウンします。

ここまで来たら一度SteamOSを起動してSDカードの容量を確認しておきましょう。
先ほどと同じように設定 > ストレージ を開きます。

![steamos-capacity](/steam-deck-windows-sd-card/02.jpg)

容量が251GBになっていますが若干のズレは無視します。半分くらいになっていることを確認してください。

実は、最初はWindows用に128GBだけ確保したのですが容量が足りずに原神のインストールができなかったのであとからWindows用の容量を増やしました。

### 空いた領域をWindowsでフォーマット

次はWindowsを起動します。
自分はWindows 11ですがWindows 10でも手順は変わらないと思います。

Windowsボタンを右クリックし「ディスクの管理」を選択します。
ディスク1（リムーバブルディスク）の後半が「未割り当て」になっていると思います。この領域をフォーマットしてWindowsで使用します。

![windows-1](/steam-deck-windows-sd-card/03.jpg)

※上の画像はすでにフォーマット済みなので表示が異なります

未割り当ての領域を右クリックし「新しいシンプルボリューム」をクリックします。

[ボリュームサイズの指定]はそのまま次へ進みます。

![windows-2](/steam-deck-windows-sd-card/04.jpg)

[ドライブ文字またはパスの割り当て]ですが、ドライブレターが分かれてしまうのがなんだか気持ち悪かったので「空のNTFSフォルダーにマウントする」を選択しました。自分のプロファイルフォルダにGameフォルダを作成しています。
「ドライブ文字を割り当てる」を選んでも問題ありません。ここは自由です。

![windows-3](/steam-deck-windows-sd-card/05.jpg)

[パーティションのフォーマット]ではそのまま次へ進みます。
お好みでラベルを設定するとよいでしょう。自分は「Game」というラベルをつけました。

![windows-4](/steam-deck-windows-sd-card/06.jpg)

以上で完了です。ここで作成したドライブにゲームをインストールしましょう。

自分が買ったSDカードはこれ。値は張りましたが速度は申し分なし。原神のロード時間も体感では全く問題ありませんでした。

{{< affiliate asin="B08927YRXX" title="SanDisk マイクロSD 512GB サンディスク Extreme microSDXC A2 SDSQXA1-512G-GN6MN SD変換アダプターなし 海外パッケージ品" >}}

以上

## 2023/8/29追記：SteamDeck+Windowsの使用感

半年以上ほぼ毎日使っていく中で気がついたことをまとめてみます。

* パフォーマンスは上々  
    SDカードの読み書き速度も含めて、携帯ゲーム機として見ればパフォーマンスで特に不満に思うことはありませんでした
* ときどきSDカードを認識しなくなる  
    1～2ヶ月に1回くらいの頻度でSDカードを認識しなくなる事象が発生しました。  
    予兆として読み書き速度が非常に遅くなってまともにゲームをプレイできない状態になり、その後のサスペンドからの復帰のタイミングでSDカードが見えなくなるといった感じです。  
    使用中は本体もかなり発熱していたのでそれが原因かもしれません。  
    シャットダウン→起動（OS再起動ではダメ）で復旧できますがややストレスでした。
* SWICDの起動に失敗することがある  
    サスペンドからの復帰やOS起動時にSWICDの起動に失敗（落ちてしまう）ことが頻繁にありました。体感2回に1回以上の頻度です。  
    SWICDのプロセス自体は残ってしまうようで、一度この状態になったらタスクマネージャからプロセスを落としてSWICDを起動し直すという操作が必要でした。頻度がそれなりに高く、こちらもストレスになっていました。

何よりSteamOSの完成度が素晴らしいのにそれをほとんど使えないというのが自分にとっては一番のマイナスポイントでした。  
他のゲームは基本的にSteamOSでやりたかったのでWindowsにはインストールしておらず、他のゲームをプレイするには一度再起動が必要なので、ほぼ原神専用機のようになってしまっており、
SteamDeck自体のよさを存分に発揮できていなかったと思います。  
[現在はSteamOS上で普通に原神が動くようになった](../steamdeck-upgrade-ssd-and-install-windows/)のでそちらでプレイしています。

## 参考

[SteamDeckに原神をインストール - ゆきんこブログ](https://yukinko.tech/howtoinstallwindowstosteamdeck/)

[^1]: この記事を書いたあと[btrfsを使う方法](https://note.com/asami_konno/n/n9fdb07744546)があることがわかりました。Windowsにおけるbtrfsのパフォーマンスが気になるところですが、近いうちに試してみるつもりです
