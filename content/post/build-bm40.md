+++
slug = ""
tags = ["gadget"]
title = "BM40ビルドログ"
date = "2023-12-24T03:45:24+09:00"
+++

![001.jpg](/build-bm40/001.jpg)

なにかキーボードを組みたいと思っていたところ、Aliexpressでセールしていたため思い切ってBM40という40%キーボードを購入してみました。
自分としては初めての40%キーボードになります。

<!--more-->

# 購入品

物はすべてAliexpressで揃えました。

|購入品|価格|
|:--|:--|
|[PCB KPrepublic BM40](https://s.click.aliexpress.com/e/_DC2d3dx)|7,005円|
|[スイッチプレート](https://s.click.aliexpress.com/e/_DnctRv3)|1,665円|
|[ケース](https://s.click.aliexpress.com/e/_Dehm1l7)|4,554円|
|[キースイッチ Gateron G Pro 3.0 Red 70個](https://s.click.aliexpress.com/e/_Dlv0d2h)|2,560円|
|[XDAプロファイル 1uキーキャップ 60個](https://ja.aliexpress.com/item/1005005439129217.html)|2,640円|
|[XDAプロファイル 2uキーキャップ 1個](https://s.click.aliexpress.com/e/_DezAgEZ)|777円|

合計で19,301円でした。
ただし今回のキーボードは47キーしかありませんのでキースイッチとキーキャップはいくつか余ります。

# 組み立て

途中の写真は撮り忘れました。
基板はすべて実装済みなのではんだ付けは不要。
キースイッチもソケットが実装済みなのでソケットに取り付けていくだけで完成します。

# ファームウェアビルド

ファームウェアは初めからインストール済みのためすぐに使い始めることができますが、キーマップのカスタマイズは自作キーボードの醍醐味のひとつですので早速カスタマイズしていきます。
[公式サイト](https://kprepublic.com/)上部のDownloadからマニュアルやビルド済みのファームウェアがダウンロードできますが、基本的には[Keyboard Firmware Builder](https://kbfirmware.com/)というサイトにキーマップを定義したjsonをアップロードすることでファームウェアをビルドする手順のようです。

自分の場合はキーマップをバージョン管理したかったのと手元でQMKファームウェアをビルドする環境がセットアップ済みのため自分でソースコードからビルドすることにします。
（実はキーボード選定の時点でこれができることを確認した上でBM40を選択しています）

BM40用のソースコードは[本家リポジトリ](https://github.com/qmk/qmk_firmware/tree/master/keyboards/kprepublic/bm40hsrgb/rev2)に取り込まれているので手元でビルドします。
（BM40には基板のバージョンが2通りあるようです。自分の場合は基板の裏面にrev2と書かれていました）

[公式サイト](https://docs.qmk.fm/#/)通りの手順のためビルド手順は省略します。

# キーマップの作成

で、出来上がったキーマップが[こちら](https://github.com/uyorum/qmk_firmware/blob/mine/bm40/keyboards/kprepublic/bm40hsrgb/rev2/keymaps/uyorum/keymap.c)

```
/* Qwerty
 * ,-----------------------------------------------------------------------------------.
 * |  Tab |   Q  |   W  |   E  |   R  |   T  |   Y  |   U  |   I  |   O  |   P  |   @  |
 * |------+------+------+------+------+------+------+------+------+------+------+------|
 * | Ctrl |   A  |   S  |   D  |   F  |   G  |   H  |   J  |   K  |   L  |   ;  |   :  |
 * |------+------+------+------+------+------+------+------+------+------+------+------|
 * | Shift|   Z  |   X  |   C  |   V  |   B  |   N  |   M  |   ,  |   .  |   /  |   _  |
 * |------+------+------+------+------+------+------+------+------+------+------+------|
 * |  Esc |  GUI |  Alt | Bksp/| F19/ |    Space    | F20/ |Enter/|   -  |   ^  |   \  |
 * |      |      |      | Ctrl | Lower|             | Raise| Shift|      |      |      |
 * `-----------------------------------------------------------------------------------'
 */

/* Lower
 * ,-----------------------------------------------------------------------------------.
 * | 半/全|   !  |   "  |   #  |   $  |   %  |   &  |   '  |   =  |   ~  |   |  |  Del |
 * |------+------+------+------+------+------+------+------+------+------+------+------|
 * |      |      |      |   [  |   {  |   (  |   )  |   }  |   ]  |      |      |      |
 * |------+------+------+------+------+------+------+------+------+------+------+------|
 * |      |      |      |      |      |      |      |      |A+PScr| Pg Up|  Up  | Pg Dn|
 * |------+------+------+------+------+------+------+------+------+------+------+------|
 * |      |      |      |      | XXXX |             |      | PrtSc| Left | Down | Right|
 * `-----------------------------------------------------------------------------------'
 */

/* Raise
 * ,-----------------------------------------------------------------------------------.
 * | 半/全|   1  |   2  |   3  |   4  |   5  |   6  |   7  |   8  |   9  |   0  |  Del |
 * |------+------+------+------+------+------+------+------+------+------+------+------|
 * |      |      |      |   [  |   {  |   (  |   )  |   }  |   ]  |      |      |      |
 * |------+------+------+------+------+------+------+------+------+------+------+------|
 * |      |  F1  |  F2  |  F3  |  F4  |  F5  |  F6  |  F7  |  F8  |  F9  |  F10 |      |
 * |------+------+------+------+------+------+------+------+------+------+------+------|
 * |      |  F11 |  F12 |      |      |             | XXXX | Next | Vol- | Vol+ | Play |
 * `-----------------------------------------------------------------------------------'
 */

/* Adjust (Lower + Raise)
 *                      v------------------------RGB CONTROL--------------------v
 * ,-----------------------------------------------------------------------------------.
 * |      | Reset|Debug | RGB  |RGBMOD| HUE+ | HUE- | SAT+ | SAT- |BRGTH+|BRGTH-|      |
 * |------+------+------+------+------+------+------+------+------+------+------+------|
 * |      |      |      |      |      |      |      |      |      |      |      |      |
 * |------+------+------+------+------+------+------+------+------+------+------+------|
 * |      |      |      |      |      |      |      |      |      |      |      |      |
 * |------+------+------+------+------+------+------+------+------+------+------+------|
 * |      |      |      |      |      |             |      |      |      |      |      |
 * `-----------------------------------------------------------------------------------'
 */
```

日本語配列をベースにレイヤーを駆使して記号や数字を配置。  
日本語配列なので右側が窮屈ですが単キー押しで入力できる記号が多くなのでこれはこれで良いのかなと思っています。  
親指のあたりはQMKのホールド機能を使って複数の機能を持たせています。40%キーボードなのでこれは必然かなと。  
自分はIMEの設定でF19にIMEオフ、F20に日本語入力を設定しているのでMacぽい切り替えができるようになっています。

試しにこのブログ記事はこのキーボードでほとんど入力してみましたが、案外すんなり打てました。ただし右下の記号やEnterがどうしても誤爆がちですが、これくらいは打っていくうちに慣れると思います。

ファームウェアが出来上がったらQMK Toolboxを使って焼いていきます。
キーボードの左上のキーを押しながらUSBを接続することでDFUモードに入ります。

# いくつかの不満

* PCBが滑る  
    PCBとケースをネジ止めしていますが、PCBが完全に固定されず若干グラグラする状態です。現在は滑り止めを挟んで対処しています。
* タイピング時に金属音ぽい音が響く  
    タイピング時にケースに音が響いて若干金属ぽい音がするのが気になります。
* 重い
    ケースが金属製のため見た目以上に重いです。測ったところ460gもありました。
    ノートPCと一緒に使おうと思っているので重すぎると持ち運びに支障が出ます。

だいたいケースに起因する問題なので3Dプリンタでケースを自作することで解決できそうです。
時間を見つけて今度はケースを自作してみようと思います。

以上

# 参考

[BM40V2（自作キーボード）の設定｜fumix](https://note.com/fumix/n/n5e7da2224acf)
ファームウェアの焼き方など参考にさせていただきました
